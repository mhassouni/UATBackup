<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>API_Connector__IWS_Indued_API_Connector</fullName>
    <availability>online</availability>
    <description>This button is used to make callout to IndueD Service APIs for retrieving information.</description>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>indueD</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&#39;//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&#39;)}
{!REQUIRESCRIPT(&#39;//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js&#39;)}
{!REQUIRESCRIPT(&quot;/support/console/43.0/integration.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/43.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/43.0/apex.js&quot;)}
debugger;
try{
showConfirmation();
}
catch(e){
alert(&#39;An Error has Occured. Error: &#39; + e);
}
function showConfirmation(){
jQuery(function() {
jQuery(&#39;head&#39;).append(&#39;&lt;link rel=&quot;stylesheet&quot; href=&quot;//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/start/jquery-ui.css&quot; type=&quot;text/css&quot; /&gt;&#39;);
var html =
&#39;&lt;div id=&quot;IndueDServiceDialog&quot; title=&quot;indueD Service&quot;&gt;&lt;p&gt;Are you sure to check this record for indueD Services?&lt;/p&gt;&lt;/div&gt;&#39;;
if(!jQuery(&#39;[id=IndueDServiceDialog]&#39;).size()){
jQuery(&#39;body&#39;).append(html);
}
jQuery( &quot;#IndueDServiceDialog&quot; ).dialog({
width: 339,
modal: true,
show: {
effect: &quot;drop&quot;,
direction : &quot;up&quot;,
duration: 700
},
buttons: {
&quot;Yes&quot;: function() {
jQuery( this ).dialog( &quot;close&quot; );
validate();
},
&quot;No&quot;: function() {
jQuery( this ).dialog( &quot;close&quot; );
}
}
});
});
}
function validate(){
try{
debugger;
showErrorDialog(&quot;Please wait till record get processed.&quot;, false, &quot;IndueD Services&quot;);
var accountId = &#39;{!Account.Id}&#39;;
var resetresponse= sforce.apex.execute(&quot;API_Connector.ServiceCallOuts&quot;, &quot;resetAccountFieldsForInduedService&quot;, {&quot;objectId&quot;:accountId});
if(resetresponse == &#39;success&#39;){
var response= sforce.apex.execute(&quot;API_Connector.ServiceCallOuts&quot;, &quot;webServiceCallouts&quot;, {&quot;objectId&quot;:accountId, &quot;serviceName&quot;:&quot;IndueD Services&quot;});
var result = JSON.parse(response);
if(result &amp;&amp; result.success &amp;&amp; result.data.API_Connector__IndueD_Portfolio_Status__c == &#39;Success&#39;){
var responseDued = sforce.apex.execute(&quot;API_Connector.ServiceCallOuts&quot;, &quot;webServiceCallouts&quot;, {&quot;objectId&quot;:accountId, &quot;serviceName&quot;:&quot;Indued Due Diligences&quot;});
var resultDued = JSON.parse(responseDued);
if((resultDued &amp;&amp; resultDued.success &amp;&amp; resultDued.data.API_Connector__IndueD_DueDiligence_ID__c != null &amp;&amp; resultDued.data.API_Connector__IndueD_DueDiligences_Status__c == &#39;Success&#39;)){
var responseDuedId = sforce.apex.execute(&quot;API_Connector.ServiceCallOuts&quot;, &quot;webServiceCallouts&quot;, {&quot;objectId&quot;:accountId, &quot;serviceName&quot;:&quot;Indued Due Diligences DuedId&quot;});
var resultDuedId = JSON.parse(responseDuedId);
if(resultDuedId &amp;&amp; resultDuedId.success &amp;&amp; resultDuedId.data.API_Connector__IndueD_DuediligencesFinal_FPM_Status__c == &#39;fpm_done&#39;){
var responseReport = sforce.apex.execute(&quot;API_Connector.ServiceCallOuts&quot;, &quot;webServiceCallouts&quot;, {&quot;objectId&quot;:accountId, &quot;serviceName&quot;:&quot;Indued Reports&quot;});
var resultReport = JSON.parse(responseReport);
if(resultReport &amp;&amp; resultReport.success &amp;&amp; resultReport.data.API_Connector__IndueD_Reports_ID__c != null){
var responseReportId = sforce.apex.execute(&quot;API_Connector.ServiceCallOuts&quot;, &quot;webServiceCallouts&quot;, {&quot;objectId&quot;:accountId, &quot;serviceName&quot;:&quot;Indued Report Id&quot;});
var resultReportId = JSON.parse(responseReportId);
}
}
}
console.log(&#39;response is successful&#39;);
location.reload();
;
}else{
$(&quot;.ui-dialog-content&quot;).dialog(&quot;close&quot;);
showErrorDialog(result.message,true,&quot;Validation Failed&quot;);
}
}
}catch(e){
alert(&#39;An Exception has Occurred. Exception : &#39; + e);
}
}
function showErrorDialog(msg,showButton,title) {
jQuery(function () {
jQuery(&#39;head&#39;).append(&#39;&lt;link rel=&quot;stylesheet&quot; href=&quot;//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/start/jquery-ui.css&quot; type=&quot;text/css&quot; /&gt;&#39;);
var html =
&#39;&lt;div id=&quot;errorMessage&quot; &gt;&lt;p&gt;&#39; + msg + &#39;&lt;/p&gt;&lt;/div&gt;&#39;;
jQuery(&#39;body&#39;).append(html);
var obj = {
title : title,
modal: true,
draggable: false
}
if(showButton){
obj[&quot;buttons&quot;] = {
OK: function () {
jQuery(this).dialog(&quot;close&quot;);
}
};
}
jQuery(&quot;#errorMessage&quot;).dialog(obj);
});
}</url>
</WebLink>
