import{h as I,j as G,r,m as O,v as C,J as re,u as s,ag as ie,A as u,S as ue,z as E,q as o,a2 as R,_ as M,k as x,y as de,F as be,x as D,B as N,W as U,ac as ve,I as J,a6 as q,a7 as K,c as V,o as _e,w as fe,M as he,a3 as pe}from"./index.js";import{e as T,c as Ee,C as De,J as Je,N as z}from"./ConfirmationModal.a006cf8e.js";import{P as Ce,E as Se}from"./EmptyState.08a8d7f0.js";import"./dcJobService.b3701bc0.js";import"./dcHelper.d839f820.js";const me={key:0,class:"spinnerContainer"},Oe={class:"buttons"},ye={class:"button"},Be=I({__name:"ScheduledHeader",props:{isLoading:{type:Boolean},newJobOpen:{}},setup(_){const{t:l}=G(),t=ie(),d=r([{label:l("titles.DCJOB_JOBPAGE_JOBOVERVIEW"),callback:()=>t.push("/"),active:!1},{label:l("titles.DCJOB_SCHEDULEDJOBPAGE_SCHEDULEDJOB"),callback:()=>{},active:!0}]);return(f,h)=>(u(),O("div",null,[C(Ce,{title:s(l)("titles.DCJOB_SCHEDULEDJOBPAGE_SCHEDULEDJOB"),"sub-title":"Duplicate Check",options:d.value,"dropdown-header":s(l)("titles.DCJOB_JOBPAGE_LISTVIEWS")},{buttons:re(()=>[f.isLoading?(u(),O("div",me,[C(s(ue),{size:"medium",variant:"primary"})])):E("",!0),o("div",Oe,[o("span",ye,[C(s(R),{label:s(l)("buttons.DCJOB_SCHEDULEDJOBPAGE_NEWJOB"),icon:"slds-icon-new","icon-color":"#747474",onClick:f.newJobOpen},null,8,["label","onClick"])])])]),_:1},8,["title","options","dropdown-header"])]))}});const ge=M(Be,[["__scopeId","data-v-13a733f6"]]),we={class:"body-content truncate"},He={class:"body-content truncate"},Le=["title"],ke={class:"body-content truncate"},Ae={class:"status"},Pe={class:"body-content truncate"},Te={class:"body-content"},Ne={class:"last-content"},Ue=I({__name:"ScheduleTableBody",props:{scheduleJobs:{},statusOptionIsDisabled:{type:Boolean},startScheduledJob:{},statusScheduledJob:{},infoScheduledJob:{},editScheduleJobHandler:{},openDeleteModalScheduledJob:{}},setup(_){const{t:l}=G();x();const t=_,d=(e,i)=>e===i?e:`${e} to ${i}`,f=e=>{const i=e==="Active";return{size:i?16:14,name:i?"slds-icon-success active":"slds-icon-close error",color:i?"#2e844a":"#ea001e"}};function h(e){return e?.filters!==void 0&&e?.filterLogic!==void 0}const L=e=>{const i=e.filterOn==="filter"&&h(e.selectedInfo.sourceFilter)||e.filterOn===null||e.filterOn==="all"||e.filterOn.startsWith("predefined-"),b=e.filterWith==="filter"&&h(e.selectedInfo.matchFilter)||e.filterWith===null||e.filterWith==="all"||e.filterWith==="source"||e.filterWith.startsWith("predefined-");return i&&b},$=e=>{if(!t.scheduleJobs)return;const i=t.scheduleJobs[e].internalStatus==="Active",b={isHeader:!0,label:l("job.menuOptions.DCJOB_SCHEDULEDJOBPAGE_TITLE")},S=[{isHeader:!1,label:l(i?"buttons.DCJOB_SCHEDULEDJOBPAGE_DEACTIVATED":"buttons.DCJOB_SCHEDULEDJOBPAGE_ACTIVATE"),disabled:t.statusOptionIsDisabled,align:!1,iconPos:"left",iconColor:"#747474",icon:i?"slds-icon-close":"slds-icon-check",callback:()=>t.statusScheduledJob(e)},{isHeader:!1,label:l("buttons.DCJOB_SCHEDULEDJOBPAGE_RUNNOW"),disabled:t.statusOptionIsDisabled,align:!1,iconPos:"left",iconColor:"#747474",icon:"slds-icon-play",callback:()=>t.startScheduledJob(e)},{isHeader:!1,label:l("buttons.DCJOB_SCHEDULEDJOBPAGE_EDIT"),disabled:!L(t.scheduleJobs[e]),align:!1,iconPos:"left",iconColor:"#747474",icon:"slds-icon-edit",callback:()=>t.editScheduleJobHandler(e)},{isHeader:!1,label:l("buttons.DCJOB_SCHEDULEDJOBPAGE_DELETE"),align:!1,iconPos:"left",iconColor:"#747474",icon:"slds-icon-delete",callback:()=>t.openDeleteModalScheduledJob(e)}];return[b,...S]},k=(e,i)=>i==="Inactive"?l("general.DCJOB_SCHEDULEDJOBPAGE_NOTAPPLICABLE"):e;return(e,i)=>(u(!0),O(be,null,de(e.scheduleJobs,({jobName:b,sourceObject:S,matchObject:H,scheduleFormat:m,internalStatus:y,status:B,jobId:p,nextDateFormat:A})=>(u(),O("tr",{key:p,class:"row-body"},[o("td",we,D(b),1),o("td",He,D(d(S.label,H.label)),1),o("td",{title:m,class:"body-content truncate"},D(m),9,Le),o("td",ke,[o("div",Ae,[C(s(N),{size:f(y).size,name:f(y).name,color:f(y).color},null,8,["size","name","color"]),U(" "+D(B),1)])]),o("td",Pe,D(k(A,B)),1),o("td",Te,[o("div",Ne,[C(s(R),{icon:"slds-icon-info","icon-color":"#747474",label:s(l)("buttons.DCJOB_SCHEDULEDJOBPAGE_INFO"),onClick:n=>e.infoScheduledJob(p)},null,8,["label","onClick"]),C(s(ve),{options:$(p),"icon-pos":"left","menu-pos":"right","align-icons":!0,label:s(l)("buttons.DCJOB_SCHEDULEDJOBPAGE_JOBOPTIONS")},null,8,["options","label"])])])]))),128))}});const $e=M(Ue,[["__scopeId","data-v-e4e6b2be"]]),Ie=_=>(q("data-v-09af1b3c"),_=_(),K(),_),Ge={class:"row-header"},Me={class:"wrapper-col-title-content sortable"},je={class:"wrapper-col-title-content sortable"},Ve={class:"wrapper-col-title-content"},We={role:"button"},Fe={class:"wrapper-col-title-content sortable"},ze={class:"wrapper-col-title-content sortable"},Re=Ie(()=>o("th",{class:"last-header"},null,-1)),xe=I({__name:"ScheduleTableHeader",props:{sortColumnHandler:{},fetchDataSortController:{},tableSortController:{}},setup(_){const{t:l}=G();return(t,d)=>(u(),O("tr",Ge,[o("th",null,[o("div",Me,[o("a",{role:"button",onClick:d[0]||(d[0]=f=>t.sortColumnHandler("name"))},[U(D(s(l)("general.DCJOB_SCHEDULEDJOBPAGE_NOME"))+" ",1),t.fetchDataSortController.sortingColumn==="name"?(u(),J(s(N),{key:0,name:t.tableSortController.iconName,color:"#747474"},null,8,["name"])):E("",!0)])])]),o("th",null,[o("div",je,[o("a",{role:"button",onClick:d[1]||(d[1]=f=>t.sortColumnHandler("object"))},[U(D(s(l)("general.DCJOB_SCHEDULEDJOBPAGE_OBJECT")),1),t.fetchDataSortController.sortingColumn==="object"?(u(),J(s(N),{key:0,name:t.tableSortController.iconName,color:"#747474"},null,8,["name"])):E("",!0)])])]),o("th",null,[o("div",Ve,[o("a",We,D(s(l)("general.DCJOB_SCHEDULEDJOBPAGE_FREQUENCYANDTIME")),1)])]),o("th",null,[o("div",Fe,[o("a",{role:"button",onClick:d[2]||(d[2]=f=>t.sortColumnHandler("status"))},[U(D(s(l)("general.DCJOB_SCHEDULEDJOBPAGE_STATUS")),1),t.fetchDataSortController.sortingColumn==="status"?(u(),J(s(N),{key:0,name:t.tableSortController.iconName,color:"#747474"},null,8,["name"])):E("",!0)])])]),o("th",null,[o("div",ze,[o("a",{role:"button",onClick:d[3]||(d[3]=f=>t.sortColumnHandler("nextstart"))},[U(D(s(l)("general.DCJOB_SCHEDULEDJOBPAGE_NEXTSTART")),1),t.fetchDataSortController.sortingColumn==="nextstart"?(u(),J(s(N),{key:0,name:t.tableSortController.iconName,color:"#747474"},null,8,["name"])):E("",!0)])])]),Re]))}});const qe=M(xe,[["__scopeId","data-v-09af1b3c"]]),Ke=_=>(q("data-v-74252967"),_=_(),K(),_),Qe={class:"bodyContainer"},Xe={class:"jobContainer"},Ye={key:0,class:"empty"},Ze={class:"noJobs"},et={class:"text"},tt=Ke(()=>o("span",{class:"count"},"0/0",-1)),ot={key:1,class:"wrapper-table"},W=10,lt=I({__name:"ScheduledJobOverviewPage",setup(_){const{t:l}=G(),t=x(),d=r(0),f=V(()=>Object.keys(n.value).length===0),h=r(1),L=r(),$=r(),k=r(!1),e=r(!1),i=r(!1),b=r(!1),S=r(!1),H=r(!1),m=r(!1),y=r({title:"",message:""}),B=r({type:"",label:""}),p=r({name:!0,object:!0,status:!0,nextstart:!0,iconName:"slds-icon-arrowup"}),A=r({sortingColumn:"nextstart",sortDescending:p.value.nextstart});_e(async()=>{const a=new Date().getTime();await g(),t.recordEvent("DC Scheduled Job Overview - Loaded",{load_time:new Date().getTime()-a,component_title:"Scheduled Job Overview",number_of_scheduled_jobs:P.value,dc_job_beta:!0}),t.persist()});const n=r({}),P=r(0),Q=V(()=>W<P.value?Math.ceil(P.value/W):1);async function g(a=!1){try{d.value+=1,a&&(h.value=1);const{sortingColumn:c,sortDescending:v}=A.value,w=await T.getScheduledListByPageWithSorting(h.value-1,10,c,v);P.value=w.totalJobs,n.value=w.jobList}catch(c){console.error(c)}finally{d.value-=1}}async function X(a){if(!!n.value)try{m.value=!0,b.value=!1;const c=n.value[a].jobId;await T.startScheduledJob(c);const v=n.value[a].jobName,w=l("filter.startedScheduledJob",[v]);j("success",w)}catch(c){console.error(c)}finally{m.value=!1}}async function Y(a){const c=new Date().getTime();try{if(!n.value)return;m.value=!0,b.value=!1;let v="error";const w=n.value[a].jobId;switch(n.value[a].internalStatus){case"Active":await T.deactivateScheduledJob(w),t.recordEvent("DC Scheduled Job - Deactivate Clicked",{time_to_deactivate:new Date().getTime()-c});break;default:await T.activateScheduledJob(w),t.recordEvent("DC Scheduled Job - Activate Clicked",{time_to_activate:new Date().getTime()-c}),v="success"}t.persist(),await g();const ne=n.value[a].jobName,ce=l(v==="success"?"filter.activeScheduledJob":"filter.deactivatedScheduledJob",[ne]);j(v,ce)}catch(v){console.error(v),j("error",v?.message??v)}finally{m.value=!1}}function j(a,c){B.value={type:a,label:c},b.value=!0}const F=r(void 0);function Z(a){!n.value||(b.value=!1,F.value=a,k.value=!0)}const ee=V(()=>n.value?.[F.value]);function te(a){!n.value||(t.recordEvent("DC Scheduled Job - Edit Clicked",{}),t.persist(),b.value=!1,L.value=n.value[a],i.value=!0)}function oe(a){!n.value||(y.value={title:l("titles.DCJOB_SCHEDULEDJOBPAGE_DELETESCHEDULEJOB"),message:l("job.delete.DCJOB_SCHEDULEDJOBPAGE_DELETESCHEDULEJOBMESSAGE",[n.value[a].jobName])},b.value=!1,$.value=a,S.value=!0)}async function le(a){try{if(!n.value)return;t.recordEvent("DC Scheduled Job - Delete Clicked",{}),t.persist(),H.value=!0,await T.deleteScheduledJob(n.value[a].jobId),await g()}catch(c){console.error(c)}finally{JSON.stringify(n.value)==="{}"&&(h.value=h.value-1),S.value=!1,H.value=!1}}const ae=async a=>{p.value[a]=!p.value[a],A.value={sortingColumn:a,sortDescending:p.value[a]},p.value.iconName=p.value[a]?"slds-icon-arrowup":"slds-icon-arrowdown",await g()},se=()=>{e.value=!0,t.recordEvent("DC Job - New Job clicked",{}),t.persist()};return fe(h,async a=>await g()),(a,c)=>(u(),O("div",{class:"scheduleJobOverviewPage",onKeyup:c[1]||(c[1]=he(v=>e.value=!1,["esc"]))},[C(ge,{"is-loading":d.value>0,"new-job-open":se,"dropdown-header":s(l)("titles.DCJOB_JOBPAGE_LISTVIEWS")},null,8,["is-loading","dropdown-header"]),o("div",Qe,[o("div",Xe,[f.value?(u(),O("div",Ye,[C(Se),o("div",Ze,[o("span",et,D(s(l)("job.DCJOB_SCHEDULEDJOBPAGE_NOSCHEDULEDJOBS")),1),tt])])):(u(),O("table",ot,[C(qe,{"sort-column-handler":ae,"fetch-data-sort-controller":A.value,"table-sort-controller":p.value},null,8,["fetch-data-sort-controller","table-sort-controller"]),C($e,{"schedule-jobs":n.value,"status-option-is-disabled":m.value,"start-scheduled-job":X,"status-scheduled-job":Y,"info-scheduled-job":Z,"edit-schedule-job-handler":te,"open-delete-modal-scheduled-job":oe},null,8,["schedule-jobs","status-option-is-disabled"])])),1<Q.value?(u(),J(Ee,{key:2,modelValue:h.value,"onUpdate:modelValue":c[0]||(c[0]=v=>h.value=v),"jobs-per-page":W,"job-number":P.value},null,8,["modelValue","job-number"])):E("",!0)])]),S.value?(u(),J(De,{key:0,title:y.value.title,message:y.value.message,"cancel-button-label":s(l)("buttons.DCJOB_SCHEDULEDJOBPAGE_CANCEL"),"confirm-button-label":s(l)("buttons.DCJOB_SCHEDULEDJOBPAGE_DELETE"),loading:H.value,"confirm-callback":()=>le($.value),"close-function":()=>S.value=!1},null,8,["title","message","cancel-button-label","confirm-button-label","loading","confirm-callback","close-function"])):E("",!0),e.value?(u(),J(z,{key:1,"close-function":()=>e.value=!1,onRefresh:g},null,8,["close-function"])):E("",!0),k.value?(u(),J(Je,{key:2,"close-function":()=>k.value=!1,job:ee.value},null,8,["close-function","job"])):E("",!0),i.value&&L.value?(u(),J(z,{key:3,"edit-mode":!0,"schedule-job-data":L.value,"close-function":()=>i.value=!1,onRefresh:g},null,8,["schedule-job-data","close-function"])):E("",!0),b.value?(u(),J(s(pe),{key:4,"close-function":()=>b.value=!1,"toast-type":B.value.type,label:B.value.label,"auto-close-timer":B.value.type==="error"?5e3:1500},null,8,["close-function","toast-type","label","auto-close-timer"])):E("",!0)],32))}});const it=M(lt,[["__scopeId","data-v-74252967"]]);export{it as default};
